<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <form name="publish">
        <input type="text" name="message">
        <input type="submit" value="Send">
    </form>

    <!-- div with messages -->
    <div id="messages"></div>
    <script language="javascript" type="text/javascript">

        // var wsUri = "wss://seller-push-ws.shopee.vn/socket.io/?region=vn&_v=new&EIO=3&transport=websocket";
        // var output;

        // function init() {
        //     output = document.getElementById("output");
        //     testWebSocket();
        // }
        const regex = /(?<=(,bB))[\d[a-zA-Z0-9 ,].+?(?=(J,))/;
        let socket = new WebSocket("wss://oec-im-frontier-va.tiktokglobalshop.com/ws/v2?token=9ddeTDLAfaPX0tO7PqiGXOoo3zYTtRjdnEE1jooD3UR9wsXePw9Ly&aid=5341&fpid=92&device_id=7171619687384563973&access_key=227ff03fe2c9226b6f4c0ecf83cf99e7&device_platform=web&version_code=10000&websocket_switch_region=VN");

        // send message from the form
        document.forms.publish.onsubmit = function () {
            let outgoingMessage = this.message.value;

            socket.send(outgoingMessage);   
            return false;
        };

        // message received - show the message in div#messages
    socket.onmessage = function (event) {
            var reader = new FileReader();
            // reader.readAsDataURL(event.data); 
            reader.onload = function() {
                let messageElem = document.createElement('div');
                messageElem.textContent = reader.result;
                document.getElementById('messages').prepend(messageElem);
                const str = reader.result.match(/[a-zA-Z0-9_. ,ÀÁÂÃÈÉÊÌÍÒÓÔÕÙÚĂĐĨŨƠàáâãèéêìíòóôõùúăđĩũơƯĂẠẢẤẦẨẪẬẮẰẲẴẶẸẺẼỀỀỂưăạảấầẩẫậắằẳẵặẹẻẽềềểỄỆỈỊỌỎỐỒỔỖỘỚỜỞỠỢỤỦỨỪễệỉịọỏốồổỗộớờởỡợụủứừỬỮỰỲỴÝỶỸửữựỳỵỷỹ]+/g).toString();
                const check = regex.exec(str);
                const mess = check?.filter(x => x != ',bB' && x != 'J,').toString().replaceAll(","," ");
                console.log(mess);
            }
            reader.readAsText(event.data);
        }

    </script>
</body>

</html>